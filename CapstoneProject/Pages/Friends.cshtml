@page
@model CapstoneProject.Pages.FriendsModel
@{
	ViewData["Title"] = "Friends";
}
<head>
	<link rel="stylesheet" href="~/css/friends.css" />
</head>



<div class="container">
	<h1>Friends</h1>
	<div class="position-relative d-inline-block">
		<button class="btn btn-primary me-md-2" id="addFriendBtn" type="button">Add Friend</button>
		<button class="btn btn-primary me-md-2" id="requestBtn" type="button">Requests (<span class="badge badge-light">4</span>)</button>

		<div id="addFriendDropdown" class="dropdown-content">
			<input type="text" id="friendSearchInput" placeholder="Search username..." />
			<div id="searchResults"></div>
		</div>
	
	
	@* <div id="RequestsDropdown" class="Requestdropdown-content">
		@foreach (var req in Model.requests)
		{
		<div class="card">
			<img src="~/Images/default.png" class="profile-pic" />
			<h4>@req</h4>
			<button class="btn-info">View Profile</button>
			<button class="btn-success">Add</button>
			<button class="btn-danger">Reject</button>
		</div>
		}
		</div>
	</div> *@

	</div>
	<div class="friends-list">
			@if (Model.Users.Any())
			{
				@foreach (var friend in Model.Users)
				{
					<div class="card">
						<img src="~/Images/@friend.Profilepic" class="profile-pic" />
						<div class="friend-info">
							<h4>@friend.Username</h4>
							<button class="btn btnview" data-userid="@friend.User_ID">View Profile</button>
							<button class="btn removebtn" data-username="@friend.Username">Remove friend</button>
						</div>
					</div>
				}
			}
			else {
				<p>You have no friends. Click "Add Friend" to find some!</p>
			}
	</div>



</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {

        // Remove friend buttons
        const removeBtns = document.querySelectorAll(".removebtn");
        removeBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                const uname = btn.getAttribute("data-username");
                Swal.fire({
                    title: "Are you sure?",
                    background: '#663e3e',
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes"
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            background: '#663e3e',
                            title: "Deleted!",
                            text: `You are no longer friends with ${uname}`,
                            icon: "success"
                        });
                    }
                });
            });
        });

        // Requests dropdown
        const reqBtn = document.getElementById("requestBtn");
        const reqDropdown = document.getElementById("RequestsDropdown");
        if (reqBtn && reqDropdown) {
            reqBtn.addEventListener("click", () => {
                reqDropdown.style.display = reqDropdown.style.display === "block" ? "none" : "block";
            });
        }

        // Add friend dropdown
        const addBtn = document.getElementById("addFriendBtn");
        const addDropdown = document.getElementById("addFriendDropdown");
        if (addBtn && addDropdown) {
            addBtn.addEventListener("click", () => {
                addDropdown.style.display = addDropdown.style.display === "block" ? "none" : "block";
            });
        }

        // Search for friends
        const searchInput = document.getElementById("friendSearchInput");
        const resultsDiv = document.getElementById("searchResults");
        if (searchInput && resultsDiv) {
            const fakeUsers = [ "WizardDude", "DragonSlayer", "KnightKing", "PotionMaster" ];
            searchInput.addEventListener("input", () => {
                const value = searchInput.value.toLowerCase();
                resultsDiv.innerHTML = "";
                if (!value) return;
                fakeUsers.filter(u => u.toLowerCase().includes(value))
                         .forEach(user => {
                            const div = document.createElement("div");
                            div.classList.add("dropdown-user");
                            div.innerHTML = `
                                <span>${user}</span>
                                <button onclick="addFriend('${user}')" class="btn btn-sm btn-success">+</button>
                            `;
                            resultsDiv.appendChild(div);
                         });
            });
        }

    });

    // Example placeholder
    function addFriend(username) {
        alert("Friend request sent to " + username);
    }
</script>
